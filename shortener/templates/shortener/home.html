{% extends 'shortener/base.html' %}

{% block content %}
<div class="url-shortener-container">
    <h2 class="main-title">–°–æ–∫—Ä–∞—Ç–∏—Ç–µ –≤–∞—à—É —Å—Å—ã–ª–∫—É</h2>

    <form method="POST" class="url-form">
        {% csrf_token %}
        {{ form.original_url }}
        <button type="submit" class="btn btn-primary btn-large">–°–æ–∫—Ä–∞—Ç–∏—Ç—å</button>
    </form>

    {% if short_url %}
    <div class="result-box">
        <h4 class="result-title">–í–∞—à–∞ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</h4>
        <div class="result-container">
            <div class="input-group">
                <input type="text"
                       value="{{ short_url }}"
                       id="short-url"
                       class="form-control result-input"
                       readonly>
                <button class="btn btn-copy" onclick="copyToClipboard()">
                    <span class="copy-icon"><i class="far fa-copy"></i></span>
                    <span class="copy-text">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
                </button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <i class="fas fa-mouse-pointer"></i>
                <span>–ü–µ—Ä–µ—Ö–æ–¥–æ–≤: {{ link.click_stats.count }}</span>
            </div>

            {% if link.clicks.exists %}
            <div class="stat-chart">
                <div class="chart-bar" style="width: 100%">
                    <div class="chart-segment desktop" style="width: {{ device_stats.desktop }}%"></div>
                    <div class="chart-segment mobile" style="width: {{ device_stats.mobile }}%"></div>
                    <div class="chart-segment tablet" style="width: {{ device_stats.tablet }}%"></div>
                </div>
                <div class="chart-labels">
                    <span><i class="fas fa-desktop"></i> –ü–ö: {{ device_stats.desktop }}%</span>
                    <span><i class="fas fa-mobile-alt"></i> –¢–µ–ª–µ—Ñ–æ–Ω—ã: {{ device_stats.mobile }}%</span>
                    <span><i class="fas fa-tablet-alt"></i> –ü–ª–∞–Ω—à–µ—Ç—ã: {{ device_stats.tablet }}%</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <a href="{{ short_url }}" class="btn btn-sm btn-success">–¢–µ—Å—Ç: –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ</a>
    </div>
    {% endif %}
</div>

<script>
function copyToClipboard() {
    const input = document.getElementById('short-url');
    input.select();
    document.execCommand('copy');

    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫
    const btn = document.querySelector('.btn-copy');
    btn.innerHTML = '<span class="copy-icon">‚úì</span><span class="copy-text">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</span>';
    btn.style.background = '#e8f5e9';
    btn.style.borderColor = '#a5d6a7';

    setTimeout(() => {
        btn.innerHTML = '<span class="copy-icon">üìã</span><span class="copy-text">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>';
        btn.style.background = '';
        btn.style.borderColor = '';
    }, 2000);
}
</script>
{% endblock %}